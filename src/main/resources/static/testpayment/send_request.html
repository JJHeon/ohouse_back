<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Charge</title>
    <script src="https://js.tosspayments.com/v1/payment"></script>
</head>

<body>
    <section>
        <h1>결제시작 하기</h1>
        <label for="start-order-button">Send StartOrderRequestDto to startOrder</label>
        <button id="start-order-button"></button>
    </section>

    <section>
        <h1>카드결제 하기</h1>
        <label for="orderId">TossPayment orderId </label>
        <input id="orderId" type="text">
        <button id="pay-button">결제하기</button>
    </section>

    <!-- startOrder 실행 -->
    <script>
        const startOrderApiRequestEndPoint = "http://localhost:8080/order/api/v1/payment";
        var httpRequest;
        /* button이 클릭되었을때 이벤트 */
        document.getElementById("start-order-button").addEventListener('click', () => {

            // 입력된 데이터 Json 형식으로 변경
            let orderedProductDto1 = new Object();
            orderedProductDto1.productId = 1;
            orderedProductDto1.adjustedPrice = 100;
            orderedProductDto1.amount = 10;
            let orderedProductDto2 = new Object();
            orderedProductDto2.productId = 2;
            orderedProductDto2.adjustedPrice = 110;
            orderedProductDto2.amount = 20;
            let orderedProductDto2 = new Object();
            orderedProductDto2.productId = 2;
            orderedProductDto2.adjustedPrice = 110;
            orderedProductDto2.amount = 20;



            // 통신에 사용 될 XMLHttpRequest 객체 정의
            httpRequest = new XMLHttpRequest();
            // httpRequest readState가 변화했을때 함수 실행
            httpRequest.onreadystatechange = () => {
                // readState가 Done이고 응답 값이 200일 때, 받아온 response를 사용
                if (httpRequest.readyState === XMLHttpRequest.DONE) {
                    if (httpRequest.status === 200) {
                        let result = httpRequest.response;
                        console.log(result);
                    }
                    else {
                        alert('request에 뭔가 문제가 있음');
                    }
                }
            }

            //Post 방식으로 요청
            httpRequest.open('POST', startOrderApiRequestEndPoint, true);
            httpRequest.responseType = "json";
            httpRequest.setRequestHeader('Content-Type', 'application/json');

            httpRequest.send(JSON.stringify(reqJson));
        })


    </script>
    <script>
        var clientKey = 'test_ck_D5GePWvyJnrK0W0k6q8gLzN97Eoq';
        var tossPayments = TossPayments(clientKey);
        var button = document.getElementById('pay-button');

        var activeTossPayments = () => {
            tossPayments.requestPayment('CARD', {
                amount: 5000,
                orderId: '1',
                orderName: '상품명',
                customerName: '고객이름',
                customerEmail: '주문자_이메일',
                successUrl: 'http://localhost:8080/success',
                failUrl: 'http://localhost:8080/fail'
            })
                .catch(function (error) {
                    console.log("Fail!");
                    console.log(error.code);
                });


        };

        console.log("Run activeToss Payment");
        button.addEventListener('click', activeTossPayments);

    </script>
</body>



</html>